pipeline {
    agent any

    triggers {
        // Poll SCM every minute
        pollSCM('*/1 * * * *')
    }

    environment {
        PORT = 3000
    }

    stages {
        stage('Checkout') {
            steps {
                script {
                    // Clone the Git repository's master branch
                    def gitRepoUrl = 'https://github.com/This-is-Ayush-Sharma/portfolio-devops.git'

                    checkout(changelog: true, poll: true, scm: [$class: 'GitSCM', 
                        branches: [[name: '*/master']], 
                        userRemoteConfigs: [[url: gitRepoUrl]], 
                        extensions: [[$class: 'CleanBeforeCheckout'], [$class: 'CloneOption', noTags: false, shallow: true, depth: 1]]
                    ])
                }   
            }
        }

        stage('Build') {
            steps {
                echo 'Building...'
                // Your build steps here
                echo 'No Build steps found...'
            }
        }

        stage('Test') {
            steps {
                echo 'Testing...'
                // Your test steps here
                echo 'No test found...'
            }
        }

        stage('Deploy') {
            steps {
                echo "Deploying your code on port ${env.PORT}!"
                sh "nohup  serve -s -l ${env.PORT}"
            }
        }
    }

    post {
        success {
            emailext(
                to: '20cse147.ayushsharma@giet.edu',
                subject: 'Build Successful: ${Jenkins.JOB_NAME} #${Jenkins.BUILD_NUMBER}',
                body: '''\
The build was successful!

Job: ${Jenkins.JOB_NAME}
Build Number: ${Jenkins.BUILD_NUMBER}
Build URL: ${Jenkins.BUILD_URL}

Best regards,
Ayush Sharma
'''
            )
        }
        failure {
            emailext(
                to: '20cse147.ayushsharma@giet.edu',
                subject: 'Build Failed: ${Jenkins.JOB_NAME} #${Jenkins.BUILD_NUMBER}',
                body: '''\
The build has failed.

Job: ${Jenkins.JOB_NAME}
Build Number: ${Jenkins.BUILD_NUMBER}
Build URL: ${Jenkins.BUILD_URL}

Please check the console output for more details.

Best regards,
Jenkins
'''
            )
        }
    }
}
